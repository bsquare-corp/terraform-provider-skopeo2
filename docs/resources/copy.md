---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "skopeo2_copy Resource - terraform-provider-skopeo2"
subcategory: ""
description: |-
  Copy resource in the Terraform provider skopeo2.
---

# skopeo2_copy (Resource)

Copy resource in the Terraform provider skopeo2.

## Example Usage

```terraform
resource "skopeo2_copy" "external-script-login" {
  source {
    image         = "docker://000000000000.dkr.ecr.eu-west-1.amazonaws.com/my-image:latest"
    login_script  = "aws ecr get-login-password --region eu-west-1 | docker login --username AWS --password-stdin 000000000000.dkr.ecr.eu-west-1.amazonaws.com"
    login_retries = 3
    login_environment = {
      AWS_PROFILE = "default"
    }
    login_script_interpreter = ["/bin/sh", "-c"]
  }
  destination {
    image         = "docker://111111111111.dkr.ecr.us-west-2.amazonaws.com/my-image:latest"
    login_script  = "aws ecr get-login-password --region us-west-2 | docker login --username AWS --password-stdin 111111111111.dkr.ecr.us-west-2.amazonaws.com"
    login_retries = 3
    login_environment = {
      AWS_ACCESS_KEY_ID     = "AKIAIOSFODNN7EXAMPLE"
      AWS_SECRET_ACCESS_KEY = "wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY"
      AWS_DEFAULT_REGION    = "us-west-2"
    }
    login_script_interpreter = ["/bin/sh", "-c"]
  }
  insecure         = false
  preserve_digests = true
  retries          = 3
  retry_delay      = 10
  additional_tags  = ["my-image:my-tag"]
  keep_image       = false
}

resource "skopeo2_copy" "internal-login-external-script-for-password" {
  source {
    image                 = "docker://000000000000.dkr.ecr.eu-west-1.amazonaws.com/my-image:latest"
    login_username        = "AWS"
    login_password_script = "aws ecr get-login-password --region eu-west-1"
    login_retries         = 3
    login_environment = {
      AWS_PROFILE = "default"
    }
    login_script_interpreter = ["/bin/sh", "-c"]
  }
  destination {
    image                 = "docker://111111111111.dkr.ecr.us-west-2.amazonaws.com/my-image:latest"
    login_username        = "AWS"
    login_password_script = "aws ecr get-login-password --region us-west-2"
    login_retries         = 3
    login_environment = {
      AWS_ACCESS_KEY_ID     = "AKIAIOSFODNN7EXAMPLE"
      AWS_SECRET_ACCESS_KEY = "wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY"
      AWS_DEFAULT_REGION    = "us-west-2"
    }
    login_script_interpreter = ["/bin/sh", "-c"]
  }
  insecure         = false
  preserve_digests = true
  retries          = 3
  retry_delay      = 10
  additional_tags  = ["my-image:my-tag"]
  keep_image       = false
}

provider "aws" {
  alias  = "source"
  region = "eu-west-1"
}

provider "aws" {
  alias  = "dest"
  region = "us-west-2"

  assume_role {
    role_arn = "arn:aws:iam::111111111111:role/dest-access"
  }
}

data "aws_ecr_authorization_token" "source" {
  provider = aws.source
}

data "aws_ecr_authorization_token" "dest" {
  provider = aws.dest
}

provider "skopeo2" {
  source {
    login_username = data.aws_ecr_authorization_token.source.user_name
    login_password = data.aws_ecr_authorization_token.source.password
  }
  destination {
    login_username = data.aws_ecr_authorization_token.dest.user_name
    login_password = data.aws_ecr_authorization_token.dest.password
  }
}

resource "skopeo2_copy" "internal-login" {
  source_image      = "docker://000000000000.dkr.ecr.eu-west-1.amazonaws.com/my-image:latest"
  destination_image = "docker://111111111111.dkr.ecr.us-west-2.amazonaws.com/my-image:latest"

  insecure         = false
  preserve_digests = true
  retries          = 3
  retry_delay      = 10
  additional_tags  = ["my-image:my-tag"]
  keep_image       = false
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Optional

- `additional_tags` (List of String) additional tags (supports docker-archive)
- `copy_all_images` (Boolean) indicates that the caller expects to copy all images from a multiple image manifest, otherwise only one image matching the system arch/platform is copied
- `destination` (Block List, Max: 1, Deprecated) Destination image location/access credentials, Overrides provider configuration. (see [below for nested schema](#nestedblock--destination))
- `destination_image` (String) specified as a "transport":"details" format.

Supported transports:
`containers-storage`, `dir`, `docker`, `docker-archive`, `docker-daemon`, `oci`, `oci-archive`, `ostree`, `sif`, `tarball`
When working with GitHub Container registry `keep_image` needs to be set to `true`.
- `docker_digest` (String) digest string for the destination image.
- `insecure` (Boolean) allow access to non-TLS insecure repositories.
- `keep_image` (Boolean) keep image when Resource gets deleted. This currently needs to be set to `true` when working with GitHub Container registry.
- `preserve_digests` (Boolean) fail if we cannot preserve the source digests in the destination image and automatically detect when the source has a different digest to the destination
- `retries` (Number) Retry the copy operation following transient failure. Retrying following access failure error is configured through login_retries in the provider configuration.
- `retry_delay` (Number) Delay between retry attempts, in seconds.
- `source` (Block List, Max: 1, Deprecated) Source image location/access credentials. Overrides provider configuration. (see [below for nested schema](#nestedblock--source))
- `source_image` (String) specified as a "transport":"details" format.

Supported transports:
`containers-storage`, `dir`, `docker`, `docker-archive`, `docker-daemon`, `oci`, `oci-archive`, `ostree`, `sif`, `tarball`

### Read-Only

- `id` (String) The ID of this resource.

<a id="nestedblock--destination"></a>
### Nested Schema for `destination`

Optional:

- `image` (String) specified as a "transport":"details" format.

Supported transports:
`containers-storage`, `dir`, `docker`, `docker-archive`, `docker-daemon`, `oci`, `oci-archive`, `ostree`, `sif`, `tarball`
When working with GitHub Container registry `keep_image` needs to be set to `true`.
- `login_environment` (Map of String) Map of environment variables passed to the login_script/login_password_script
- `login_password` (String) Registry login password
- `login_password_script` (String) Script to be executed to obtain the registry login password to be used to skopeo login. Password returned on STDOUT by the script.
- `login_retries` (Number) Either if the login_script/login_password_script reports failure with non-exit code, or if following successful login the copy operation fails, retry this number of times. Default 0
- `login_script` (String) Script to be executed by the login_script_interpreter to authenticate following skopeo operations, default true
- `login_script_interpreter` (List of String) The interpreter used to execute the login_script/login_password_script, defaults to ["/bin/sh", "-c"]
- `login_username` (String) Registry login username
- `timeout` (Number) Timeout for login_script/login_password_script to execute in seconds, default 60
- `working_directory` (String) The working directory in which to execute the login_script/login_password_script, default .


<a id="nestedblock--source"></a>
### Nested Schema for `source`

Optional:

- `image` (String) specified as a "transport":"details" format.

Supported transports:
`containers-storage`, `dir`, `docker`, `docker-archive`, `docker-daemon`, `oci`, `oci-archive`, `ostree`, `sif`, `tarball`
- `login_environment` (Map of String) Map of environment variables passed to the login_script/login_password_script
- `login_password` (String) Registry login password
- `login_password_script` (String) Script to be executed to obtain the registry login password to be used to skopeo login. Password returned on STDOUT by the script.
- `login_retries` (Number) Either if the login_script/login_password_script reports failure with non-exit code, or if following successful login the copy operation fails, retry this number of times. Default 0
- `login_script` (String) Script to be executed by the login_script_interpreter to authenticate following skopeo operations, default true
- `login_script_interpreter` (List of String) The interpreter used to execute the login_script/login_password_script, defaults to ["/bin/sh", "-c"]
- `login_username` (String) Registry login username
- `timeout` (Number) Timeout for login_script/login_password_script to execute in seconds, default 60
- `working_directory` (String) The working directory in which to execute the login_script/login_password_script, default .
